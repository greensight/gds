import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { radios, boolean, object, text } from '@storybook/addon-knobs';
import { action } from '@storybook/addon-actions';
import centeredDecorator from '../../../.storybook/decorators/centeredDecorator';
import scale from '../../utils/scale';
import theme from '../../helpers/baseTheme';
import Button, { Button as ButtonProps } from '.';

<Meta
    title="Components / Button"
    component={Button}
    decorators={[centeredDecorator]}
/>

# Button

<Story name="Knobs">
    {() => {
        const { colors, shadows } = theme;
        return (
            <Button
                theme={radios('theme', ['primary', 'secondary'], 'primary')}
                size={radios('size', ['lg', 'md', 'sm'], 'md')}
                block={boolean('block', false)}
                disabled={boolean('disabled', false)}
                Icon={boolean('icon', false) && theme.placeholder}
                iconAfter={boolean('iconAfter', false)}
                hidden={boolean('hidden', false)}
                onClick={action('onClick')}
                themeObj={boolean('Use custom theme', false) ? object('themeObj', {
                    base: {
                        css: {
                            ':focus': {
                                outlineOffset: 2,
                                outlineColor: colors.brand,
                            },
                        },
                    },
                    base: {
                        round: true,
                        half: true,
                    },
                    sizes: {
                        lg: {
                            height: scale(8),
                            padding: scale(3),
                            iconSize: scale(4),
                            iconOffset: scale(1),
                            typography: 'buttonLg',
                        },
                        md: {
                            height: scale(6),
                            padding: scale(3),
                            iconSize: scale(3),
                            iconOffset: scale(1),
                            typography: 'buttonMd',
                        },
                        sm: {
                            height: scale(5),
                            padding: scale(2),
                            iconSize: scale(2),
                            iconOffset: scale(1),
                            typography: 'buttonSm',
                        },
                    },
                    themes: {
                        primary: {
                            color: colors.white,
                            bg: colors.brand,
                            hover: {
                                bg: colors.brandHover,
                            },
                            active: {
                                border: 'transparent',
                                shadow: shadows.inner,
                            },
                            disabled: {
                                bg: colors.grey70,
                                color: colors.grey40,
                            },
                        },
                        secondary: {
                            color: colors.brand,
                            border: colors.brand,
                            bg: colors.white,
                            hover: {
                                color: colors.brandHover,
                                border: colors.brandHover,
                            },
                            active: {
                                bg: colors.grey90,
                                border: 'transparent',
                                shadow: shadows.inner,
                            },
                            disabled: {
                                border: colors.grey60,
                                color: colors.grey40,
                            },
                        },
                    },
                }) : undefined}
            >
                {text('children', 'Button')}
            </Button>
        );
    }}
</Story>

Компонент кнопки.

Кнопки определяются полем `button` в объекте темы. Его интерфейс описан ниже. В целом концепт таков, что задаются глобальные настройки стилей в `base`, после чего стилистические различия диктуются сочитанием темы из `themes` и размера из `sizes`.

После определения темы и размера для кнопки становятся доступны вариации, задаваемые через props: `block`, `disabled`, `hidden` и т.д. Т.е. эти вариации доступны для **любой** кнопки. Детальнее доступные props разобраны в разделе `Use Cases`.

Центром истины при стилизации является высота кнопки - она должна совпадать с определённой в Figma. Однако внутри компонент не ограничивается по высоте - для него автоматически выполняется расчёт вертикальных полей. Такой подход позволяет сделать multiline режим доступным по умолчанию.

Все необходимые размеры можно взять из панели `Auto Layout` в Figma, цвета берутся из палитры, типографика по имени из стилей.

Для компонента доступно получение ref и прокидывание любых html-атрибутов, неопределённых в таблице пропсов.

## Props

<Props of={ButtonProps} />

## Use Cases

### Basic

Кнопка без параметров рендерится с темой "primary" и размером "md".

<Preview>
    <Story name="Basic">
        <Button>Button</Button>
    </Story>
</Preview>

### Themes

Темы для кнопок определяются в объекте темы в поле `button.themes`. Присвоенные имена становятся доступны через проп `theme`.

**Рекомендуемые имена:** 'primary', 'secondary' и их производные - так их делят дизайнеры. Могут использоваться общепринятые типы вроде 'link' и 'subtle'.

<Preview>
    <Story id="components-button--basic" />
    <Story name="Secondary theme">
        <Button theme="secondary">Button</Button>
    </Story>
</Preview>

### Sizes

Размеры для кнопок определяются в объекте темы в поле `button.sizes`. Присвоенные имена становятся доступны через проп `size`.

**Рекомендуемые имена:** 'lg', 'md', 'sm'.

<Preview>
    <Story name="Large size">
        <Button size="lg">Button</Button>
    </Story>
    <Story id="components-button--basic" />
    <Story name="Small size">
        <Button size="sm">Button</Button>
    </Story>
</Preview>

### Block

По умолчанию ширина кнопки определяется её контентом. Проп `block` ставит размеры по ширине контейнера.

<Preview>
    <Story name="Block">
        <Button block>Button</Button>
    </Story>
</Preview>

### Disabled

Стилизация заблокированных кнопок может задаваться общая для всех тем через `global` или для каждой темы отдельно в `themes`.

<Preview>
    <Story name="Disabled">
        <Button disabled>Button</Button>
    </Story>
</Preview>

### Icons

Иконки добавляются через проп `Icon`. Иконка идёт с отступом, определённым через `iconOffset` в настройках `sizes`.

По умолчанию кнопка идёт перед текстом, но её можно поставить в конец через `iconAfter`.

<Preview>
    <Story name="With icon (before)">
        <Button Icon={theme.placeholder}>Button</Button>
    </Story>
    <Story name="With icon (after)">
        <Button Icon={theme.placeholder} iconAfter>Button</Button>
    </Story>
</Preview>

### Hidden mode

Доступен режим иконочной кнопки через проп `hidden`.

♿️ Это «hidden mode», а не «icon mode», т.к. текст при этом всё равно должен указываться для доступности с AT.

<Preview>
    <Story name="Hidden mode">
        <Button Icon={theme.placeholder} hidden>Button</Button>
    </Story>
</Preview>

### Custom icon

Проп `Icon` может принимать jsx вместо SVGR компонента.

jsx используется в редких случаях, когда нужно переопределить атрибуты иконки, например, задать цвет, отличный от цвета текста.

<Preview>
    <Story name="Custom icon">
        <Button Icon={<theme.placeholder fill={theme.colors.warning} />}>Button</Button>
    </Story>
</Preview>

### Links

Кнопку можно отрендерить в качестве ссылки - для этого достаточно передать проп `href`.

В качестве ссылки может использоваться компонент `Link` используемого роутера. Для этого нужно передать компонент роутера в проп `as` и использовать `to` вместо `href`.

Также ссылка может быть внешняя, т.е. открывать вкладку в новом окне. Чтобы задать подобное поведение, передайте проп `external`.

<Preview>
    <Story name="Link">
        <Button href="http://greensight.pro">Button</Button>
    </Story>
    <Story name="External link">
        <Button href="http://greensight.pro" external>Button</Button>
    </Story>
</Preview>

### Multiline mode

Активация многострочного режима может происходить как из-за вставки `<br/>`, так и автоматически при ограничении по ширине.

Иконка при этом выравнивается по центру кнопки.

<Preview>
    <Story name="Multiline mode (br)">
        <Button>Multiline<br/>button</Button>
    </Story>
    <Story name="Multiline mode (fixed width)">
        <Button css={{width: scale(14)}}>Multiline button</Button>
    </Story>
</Preview>

## Theme

```js
interface IButton {
    /** Глобальные стили. Распространяются на все кнопки */
    base?: IButtonRules;
    /** Стили размеров */
    sizes: {
        /** Дефолтный размер */
        md: IButtonRules;
        /** Можно добавлять свои размеры */
        [size: string]: IButtonRules;
    };
    /** Стили тем */
    themes: {
        /** Дефолтная тема */
        primary: IButtonThemeRules;
        /** Можно добавлять свои темы */
        [theme: string]: IButtonThemeRules;
    };
}

interface IButtonRules {
    /** Цвет текста и иконки */
    color?: string;
    /** Цвет фона */
    bg?: string;
    /** Цвет обводки */
    border?: string;
    /** Тень. Прежде всего для активного стейта */
    shadow?: string;
    /** Высота кнопки */
    height?: number;
    /** Горизонтальные поля */
    padding?: number;
    /** Размер иконки */
    iconSize?: number;
    /** Отступ от иконки */
    iconOffset?: number;
    /** Имя типографического стиля */
    typography?: string;
    /** Толщина обводки. Проставляется автоматически, если передан border */
    borderWidth?: number;
    /** Стиль обводки */
    borderStyle?: string;
    /** Скругление кнопки */
    borderRadius?: number | string;
    /** Режим половинчатого скругления. border-radius в половину высоты */
    half?: boolean;
    /** Режим полного скругления. border-radius в 50% для hidden режима */
    round?: boolean;
    /** Время анимации ховера */
    time?: number;
    /** Время анимации перехода на ховер. Указывается, когда нужно разделить тайминги входа/выхода */
    timeIn?: number;
    /** Функция анимации */
    easing?: string;
    /** Кастомный CSS */
    css?: Object;
}

interface IButtonThemeRules extends IButtonRules {
    /** Правила на ховер */
    hover: IButtonRules;
    /** Правила на клик */
    active: IButtonRules;
    /** Правила на блокирование */
    disabled: IButtonRules;
    /** Правила на фокус */
    focus: IButtonRules;
}

```
