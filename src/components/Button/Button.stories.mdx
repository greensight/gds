import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { radios, boolean, object, text } from '@storybook/addon-knobs';
import { action } from '@storybook/addon-actions';
import PlusIcon from '../../images/icons/plus.svg';
import major from '../../scripts/major';
import minor from '../../scripts/minor';
import theme from '../../scripts/baseTheme';
import Button from '.';
import CenteredContainer from '../../../.storybook/components/CenteredContainer';

<Meta
    title="Dev | Components / Button"
    component={Button}
    decorators={[storyFn => <CenteredContainer>{storyFn()}</CenteredContainer>]}
/>

# Button

Компонент кнопки.

Здесь будет описание.

<Story name="Knobs">
    {() => {
        const { colors } = theme.app;
        return (
            <Button
                theme={radios('theme', ['primary', 'secondary', 'link'], 'primary')}
                size={radios('size', ['lg', 'md', 'sm'], 'md')}
                block={boolean('block', false)}
                disabled={boolean('disabled', false)}
                Icon={boolean('icon', false) && PlusIcon}
                iconAfter={boolean('iconAfter', false)}
                hidden={boolean('hidden', false)}
                onClick={action('onClick')}
                themeObj={boolean('Use custom theme', false) ? object('themeObj', {
                    base: {
                        css: {
                            ':focus': {
                                outlineOffset: 2,
                                outlineColor: colors.brand,
                            },
                        },
                    },
                    sizes: {
                        lg: {
                            height: major(8),
                            padding: major(3),
                            iconSize: minor(9),
                            iconOffset: major(1),
                            typography: 'buttonLg',
                            borderRadius: 32,
                        },
                        md: {
                            height: major(6),
                            padding: major(3),
                            iconSize: major(3),
                            iconOffset: major(1),
                            typography: 'buttonMd',
                            borderRadius: 24,
                        },
                        sm: {
                            height: major(5),
                            padding: major(2),
                            iconSize: minor(3),
                            iconOffset: major(1),
                            typography: 'buttonSm',
                            borderRadius: 24,
                        },
                    },
                    themes: {
                        primary: {
                            color: colors.white,
                            bg: colors.brand,
                            hover: {
                                bg: colors.brandHover,
                            },
                            disabled: {
                                bg: colors.lighter,
                                color: colors.grey,
                            },
                        },
                        secondary: {
                            color: colors.brand,
                            border: colors.brand,
                            bg: colors.white,
                            hover: {
                                color: colors.brandHover,
                                border: colors.brandHover,
                            },
                            disabled: {
                                border: colors.light,
                                color: colors.grey,
                            },
                        },
                        link: {
                            color: colors.brand,
                            bg: 'transparent',
                            hover: {
                                color: colors.brandHover,
                            },
                            disabled: {
                                color: colors.grey,
                            },
                        },
                    },
                }) : undefined}
            >
                {text('children', 'Click me')}
            </Button>
        );
    }}
</Story>

## Props

<Props of={Button} />

## Use Cases

### Basic

Кнопка без параметров рендерится с темой "primary" и размером "md".

<Preview>
    <Story name="Basic">
        <Button>Button</Button>
    </Story>
</Preview>

### Themes

Темы для кнопок определяются в объекте темы в поле `button.themes`. Присвоенные стилизациям имена становятся доступны через проп `theme`.

**Рекомендуемые имена:** 'primary', 'secondary' и их производные - так их делят дизайнеры. Могут использоваться общепринятые типы вроде 'link' и 'subtle'.

<Preview>
    <Story name="Themes">
        <>
            <Button theme="primary" css={{marginRight: 16}}>Button</Button>
            <Button theme="secondary" css={{marginRight: 16}}>Button</Button>
            <Button theme="link">Button</Button>
        </>
    </Story>
</Preview>

### Sizes

Размеры для кнопок определяются в объекте темы в поле `button.sizes`. Присвоенные размерам имена становятся доступны через проп `size`.

**Рекомендуемые имена:** 'lg', 'md', 'sm'.

<Preview>
    <Story name="Sizes">
        <>
            <Button size="lg" css={{marginRight: 16}}>Button</Button>
            <Button size="md" css={{marginRight: 16}}>Button</Button>
            <Button size="sm">Button</Button>
        </>
    </Story>
</Preview>

### Block

По умолчанию ширина кнопки определяется её контентом. Проп `block` ставит размеры по ширине контейнера.

<Preview>
    <Story name="Block">
        <Button block>Button</Button>
    </Story>
</Preview>

### Disabled

Стилизация заблокированных кнопок может задаваться общая для всех тем через `global` или для каждой темы отдельно в `themes`.

<Preview>
    <Story name="Disabled">
        <>
            <Button disabled css={{marginRight: 16}}>Button</Button>
            <Button theme="secondary" disabled>Button</Button>
        </>
    </Story>
</Preview>

### Icons

Иконки добавляются через проп `Icon`. Иконка идёт с отступом, определённым через `iconOffset` в настройках `sizes`.

По умолчанию кнопка идёт перед текстом, но её можно поставить в конец через `iconAfter`.
<Preview>
    <Story name="Icons">
        <>
            <Button Icon={PlusIcon} css={{marginRight: 16}}>Button</Button>
            <Button Icon={PlusIcon} iconAfter>Button</Button>
        </>
    </Story>
</Preview>

### Icon only

Доступен режим иконочной кнопки через проп `hidden`. Текст при этом всё равно долже указываться для доступности с AT.

<Preview>
    <Story name="Icon only">
        <>
            <Button Icon={PlusIcon} hidden css={{marginRight: 16}}>Button</Button>
            <Button theme="secondary" Icon={PlusIcon} hidden>Button</Button>
        </>
    </Story>
</Preview>

### Custom icon

Проп `Icon` может принимать jsx вместо SVGR компонента. jsx используется в редких случаях, когда нужно переопределить атрибуты иконки, например, задать цвет, отличный от цвета текста.

<Preview>
    <Story name="Custom icon">
        <Button Icon={<PlusIcon fill="deeppink" />}>Button</Button>
    </Story>
</Preview>

### Links

Кнопку можно отрендерить в качестве ссылки - для этого достаточно передать проп `href`.

В качестве ссылки может использоваться компонент `Link` используемого роутера. Для этого нужно передать компонент роутера в проп `as` и использовать `to` вместо `href`.

Также ссылка может быть внешняя, т.е. открывать вкладку в новом окне. Чтобы задать подобное поведение, передайте проп `external`.

<Preview>
    <Story name="Links">
        <>
            <Button href="/" css={{marginRight: 16}}>Button</Button>
            <Button href="/" external>Button</Button>
        </>
    </Story>
</Preview>

### Multiline

В кнопках нет лока высоты, так что становится возможно создание многострочных кнопок без дополнительных трудозатрат.

Многострочный режим может происходить как из-за вставки `<br/>`, так и автоматически при ограничении по ширине (оба кейса показаны ниже).

Иконка при этом выравнивается по центру кнопки.

<Preview>
    <Story name="Multiline">
        <>
            <Button css={{marginRight: 16}}>Button<br/>Button</Button>
            <Button css={{width: major(15), marginRight: 16}}>Button Button</Button>
            <Button Icon={PlusIcon}>Button<br/>Button</Button>
        </>
    </Story>
</Preview>

## Theme

Объект темы для кнопки разделён на 3 группы:

1. `global` - глобальные настройки для всех кнопок проекта. Это обычный CSS;
1. `sizes` - настройки размеров. Доступны параметры `pt`, `pb`, `ph`, `iconOffset` и `typography`. При необходимости можно передать CSS;
1. `themes` - настройки тем. Доступны параметры `color`, `border`, `bg` и стейты `hover`, `active`, `disabled`, `focus`. Для указания специфичных стилей используйте CSS.

```js
interface IButtonThemeRules extends IButtonRules {
    /** Правила на ховер */
    hover: IButtonRules;
    /** Правила на клик */
    active: IButtonRules;
    /** Правила на блокирование */
    disabled: IButtonRules;
    /** Правила на фокус */
    focus: IButtonRules;
}

interface IButtonTheme {
    /** Глобальные стили. Распространяются на все кнопки */
    base: IButtonRules;
    /** Стили размеров */
    sizes: {
        /** Дефолтный размер */
        md: IButtonRules;
        /** Можно добавлять свои размеры */
        [size: string]: IButtonRules;
    };
    /** Стили тем */
    themes: {
        /** Деволтная тема */
        primary: IButtonThemeRules;
        /** Можно добавлять свои темы */
        [theme: string]: IButtonThemeRules;
    };
}

interface IButtonRules {
    /** Цвет текста и иконки */
    color?: string;
    /** Цвет фона */
    bg?: string;
    /** Цвет обводки */
    border?: string;
    /** Высота кнопки */
    height?: number;
    /** Горизонтальные поля */
    padding?: number;
    /** Размер иконки */
    iconSize?: number;
    /** Отступ от иконки */
    iconOffset?: number;
    /** Имя типографического стиля */
    typography?: string;
    /** Толщина обводки. Проставляется автоматически, если передан border */
    borderWidth?: number;
    /** Стиль обводки */
    borderStyle?: string;
    /** Скругление кнопки */
    borderRadius?: number | string;
    /** Время анимации ховера */
    time?: number;
    /** Время анимации перехода на ховер. Указывается, когда нужно разделить тайминги входа/выхода */
    timeIn?: number;
    /** Кастомный CSS */
    css?: Object;
}
```
