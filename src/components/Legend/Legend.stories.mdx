import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { text, radios, boolean, object } from '@storybook/addon-knobs';
import { action } from '@storybook/addon-actions';
import centeredDecorator from '../../../.storybook/decorators/centeredDecorator';
import * as Yup from 'yup';
import Legend from '.';
import baseTheme from '../../utils/baseTheme';
import Form from '../../components/Form';
import Button from '../../components/Button';
import ErrorIcon from '../../icons/tokens/medium/errorTriangle.svg';
import SuccessIcon from '../../icons/tokens/medium/checkCircle.svg';
import scale from '../../utils/scale';
import {
    LegendTheme,
    LegendSizeProperties,
    LegendStates,
    LegendThemeProperties,
    LegendStateProperties,
    LegendOptionalThemeProperties,
    LegendMarkThemeProperties,
    LegendProps,
} from '../../../.storybook/docgen/Legend';

<Meta title="Components / Legend" component={Legend} decorators={[centeredDecorator]} />

# Legend

<Story name="Knobs">
    <Legend
        as={text('Tag', 'legend')}
        name="Example"
        hint={boolean('Hint', true) ? text('Hint text', 'Hint') : undefined}
        hiddenLegend={boolean('Hidden legend', false)}
        size={radios('size', ['lg', 'md', 'sm'], 'md')}
        optional={boolean('Is optional?', true) ? text('Optional text', '(optional)') : undefined}
        IconBefore={boolean('Icon before', true) && baseTheme.global.placeholder}
        IconAfter={boolean('Icon after', true) && baseTheme.global.placeholder}
        block={boolean('Block', false)}
        horizontalAlignment={radios('Horizontal align', ['left', 'center', 'right'], 'left')}
        __theme={boolean('Use custom theme', false) ? object('themeObj', baseTheme.components.Legend) : undefined}
        __hintTheme={
            boolean('Use custom hint theme', false) ? object('hintThemeObj', baseTheme.components.FormHint) : undefined
        }
    >
        Legend
    </Legend>
</Story>

Легенда определяются полем `legend` в объекте темы. В целом концепт таков, что настройки диктуются сочетанием темы со стилистическими настройками из `theme` и размера из `sizes`.

После определения темы и размера для легенды становятся доступны вариации, задаваемые через props: `block`, `disabled`, `hidden` и т.д. Т.е. эти вариации доступны для **любой** легенды. Детальнее доступные props разобраны в разделе `Use cases`.

По умолчанию компонент рендерится через элемент `<label />` и наследует его пропсы. Вы можете изменить элемент через проп `as`, что позволит использовать компонент для легенд, и предоставит возможность использовать пропсы переданного компонента.

## Props

<Props of={LegendProps} />

## Theme

<Props
    components={{
        LegendTheme,
        LegendStates,
        LegendThemeProperties,
        LegendStateProperties,
        LegendSizeProperties,
        LegendOptionalThemeProperties,
        LegendMarkThemeProperties,
    }}
/>

## Use cases

### Basic

Легенда без параметров рендерится как тег `label` размером "md".

<Preview>
    <Story name="Basic">
        <Legend name="basic">Legend</Legend>
    </Story>
</Preview>

### Sizes

Размеры для легенды определяются в объекте темы в поле `legend.sizes`. Присвоенные имена становятся доступны через проп `size`.

**Рекомендуемые имена:** 'lg', 'md', 'sm'.

<Preview>
    <Story name="Large size">
        <Legend name="size-lg" size="lg">
            Legend
        </Legend>
    </Story>
    <Story id="components-legend--basic" />
    <Story name="Small size">
        <Legend name="size-sm" size="sm">
            Legend
        </Legend>
    </Story>
</Preview>

### Hint

Подсказка для легенды рендерится с помощью внутреннего компонента `FormHint`. Проп `size` `FormHint` получает у легенды.

<Preview>
    <Story name="Hint">
        <Legend name="hint" hint="Hint">
            Пример лейбла/легенды
        </Legend>
    </Story>
</Preview>

### Icons

Иконки слева от текста добавляются через проп `IconBefore`. Иконки справа от текста - через проп `IconAfter`. Иконки слева от текста добавляются через проп `IconBefore`. Иконка идёт с отступом, определённым через `iconOffset` в настройках `sizes`.

<Preview>
    <Story name="Icon (before)">
        <Legend name="icon-before" IconBefore={baseTheme.global.placeholder}>
            Legend
        </Legend>
    </Story>
    <Story name="Icon (after)">
        <Legend name="icon-after" IconAfter={baseTheme.global.placeholder}>
            Legend
        </Legend>
    </Story>
    <Story name="Icon (both)">
        <Legend name="icon-both" IconBefore={baseTheme.global.placeholder} IconAfter={baseTheme.global.placeholder}>
            Legend
        </Legend>
    </Story>
</Preview>

### Block

По умолчанию ширина текста легенды определяется контентом. Проп `block` ставит размеры по ширине родителя. Проп `block` имеет смысл использовать для легенды с иконками, если иконки нужно прижать к краям родительского блока.

<Preview>
    <Story name="Block">
        <Legend name="block" block>
            Legend
        </Legend>
    </Story>
    <Story name="Block (icons)">
        <Legend
            name="block-cons"
            block
            IconBefore={baseTheme.global.placeholder}
            IconAfter={baseTheme.global.placeholder}
        >
            Legend
        </Legend>
    </Story>
</Preview>

### Horizontal Alignment

По умолчанию текст легенды и иконки прижаты к левому краю. С помощью пропа `horizontalAlignment` можно прижать к правому или выровнять по центру.

<Preview>
    <Story id="components-legend--basic" />
    <Story name="Align to center">
        <Legend name="center" horizontalAlignment="center">
            Legend
        </Legend>
    </Story>
    <Story name="Align to right">
        <Legend name="right" horizontalAlignment="right">
            Legend
        </Legend>
    </Story>
</Preview>

### Hidden mode

♿️ Для визуально скрытой легенды текст и подсказка будут визуально скрыты, при этом они будут доступны для AT.

<Preview>
    <Story name="Hidden mode">
        <Legend name="hidden" hiddenLegend={true}>
            Legend
        </Legend>
    </Story>
</Preview>

### Optional text

Опциональный текст, указывающий на необязательность поля, к которому относится легенда.

<Preview>
    <Story name="Optional">
        <Legend name="optional" optional="(optional)">
            Пример лейбла/легенды
        </Legend>
    </Story>
</Preview>

### With Form

<Preview>
    <Story name="Inside Form">
        {() => {
            const initialValues = {
                exampleInput: '',
            };
            const validationSchema = Yup.object().shape({
                exampleInput: Yup.string().required('Обязательное поле'),
            });
            return (
                <Form
                    initialValues={initialValues}
                    validationSchema={validationSchema}
                    onSubmit={action('Submit')}
                    style={{ width: '25vw', minWidth: '320px' }}
                    ErrorIcon={ErrorIcon}
                    SuccessIcon={SuccessIcon}
                    showSuccess={boolean('showSuccess', true, 'Form')}
                    requiredRule={radios('requiredRule', ['optional', 'mark'], 'mark', 'Form')}
                    errorPosition={radios('errorPosition', ['top', 'bottom'], 'top', 'Form')}
                >
                    <Form.Field
                        controlId="exampleInput"
                        size={radios('size', ['lg', 'md', 'sm'], 'md', 'Field')}
                        hint={
                            boolean('Hint', true, 'Field')
                                ? text('Hint text', 'Подсказка к полю 1', 'Field')
                                : undefined
                        }
                        hintPosition={radios('hintPosition', ['top', 'bottom'], 'top', 'Field')}
                        hiddenLabel={boolean('Hidden Label', false, 'Field')}
                        validationPosition={radios(
                            'validationPosition',
                            ['labelBefore', 'labelAfter', 'inputBefore', 'inputAfter'],
                            'labelAfter',
                            'Field',
                        )}
                        style={{ marginBottom: scale(2) }}
                    >
                        <Legend
                            as={text('Tag', 'label')}
                            IconBefore={boolean('Icon before', true, 'Legend') && baseTheme.global.placeholder}
                            IconAfter={boolean('Icon after', true, 'Legend') && baseTheme.global.placeholder}
                            block={boolean('Block', false, 'Legend')}
                            horizontalAlignment={radios(
                                'Horizontal align',
                                ['left', 'center', 'right'],
                                'left',
                                'Legend',
                            )}
                            __theme={
                                boolean('Use custom theme', false, 'Legend')
                                    ? object('themeObj', baseTheme.components.Legend)
                                    : undefined
                            }
                        >
                            Лейбл
                        </Legend>
                        <Form.Input />
                    </Form.Field>
                    <Button type="submit">Submit</Button>
                </Form>
            );
        }}
    </Story>
</Preview>
