import { Meta, Props } from '@storybook/addon-docs/blocks';
import ThemeProvider from '.';

<Meta title="Components / ThemeProvider" component={ThemeProvider} />

# ThemeProvider

`ThemeProvider` является обёрткой вокруг компонента `ThemeProvider` из css in js библиотеки `emotion`, которую использует GDS. Через него на проект прокидывается объект темы проекта и тем самым достигается мультибрендовость: компоненты диктуют API и ожидают увидеть тему.

## Props

<Props of={ThemeProvider} />

## Использование

`ThemeProvider` является обязательным требованием для обеспечения работы GDS. Оберните приложение в него следующим образом:

```js
<ThemeProvider theme={theme}>
    <App />
</ThemeProvider>
```

Для Storybook это можно сделать через декоратор:

```js
addDecorator(storyFn => <ThemeProvider theme={theme}>{storyFn()}</ThemeProvider>);
```

Если тему не передать, то будет применена стандартная тема GDS, но разрабатывая проект, вы хотите всё-таки передать свою.

В качестве темы должен передаваться объект, созданный с помощью хелпера `createTheme`, в который загружаются токены и ручные настройки.

```js
const theme = createTheme({
    tokens,
    theme: {
        // Project settings
    },
});
```

Допускается создание темы без токенов, однако тогда вы потеряете множество удобств системы.

## Global

Помимо прокидывания темы внутри `ThemeProvider` происходит вставка `Global` из `emotion`, через который определяются глобальные стили проекта. GDS идёт со встроенными стилями, которые параметризируются через тему, и поддерживает добавление собственных стилей.

Встроенное содержимое:

1. Стили нормализации через [normalize.css](https://necolas.github.io/normalize.css/)
1. Определения шрифтов
1. Базовые стили

Помимо этого вы можете передать любой CSS, который должен быть применён глобально.

**Интерфейс:**

```js
interface IGlobal {
    /** Подключения шрифтов */
    fonts?: IGlobalFonts;
    /** Базовые стили */
    base?: IGlobalBase;
    /** Кастомный CSS */
    css?: object;
}
```

### Fonts

Вы можете определить шрифты проекта через поле `global.fonts` объекта темы. Из определённой темы создаётся набор правил `@font-face`.

GDS поддерживает обычные и вариативные шрифты. Для подключения обычного шрифта необходимо определить пути до ассета woff2 и woff в качестве фоллбека в соответствующих переменных. Для вариативного шрифта передайте путь до woff2 через переменную `vf`.

Каждое начертание кроме стандартного должно определять параметры `weight` и/или `italic`. Дополнительные параметры, вроде нестандартных параметров вариативных шрифтов можно передать через `css`.

При указании вариативного шрифта в дальнейшем он доступен через имя семейста с припиской "VF": `font-family: 'name VF'`.

⚠️ У вариативных шрифтов уже хорошая поддержка ([Caniuse](https://caniuse.com/#feat=variable-fonts)), но всё ещё имеет смысл использовать фоллбеки. Это можно сделать через `@supports (font-variation-settings: normal)` - хелпер `typography` это сделает за вас, предоставив обычную версию шрифта, если вы её определили.

⚠️ Передавать woff для вариативных шрифтов не имеет смысла, т.к. все браузеры, поддерживающие вариативные шрифты, поддерживают woff2.

⏱ Во все правила прописывается `font-display: swap` для избежания FOIT.

**Интерфейс:**

```js
interface IGlobalFontsTheme {
    /** Список семейств шрифтов */
    [fontFamily: string]: IGlobalFontFamilyRules[];
}

interface IGlobalFontFamilyRules {
    /** Путь до ассета шрифта (формат woff2) */
    woff2?: string;
    /** Путь до ассета шрифта (формат woff) */
    woff?: string;
    /** Путь до ассета шрифта (формат woff2) */
    vf?: string;
    /** Толщина шрифта */
    weight?: number | string;
    /** Курсивное начертание */
    italic?: boolean;
    /** Кастомный CSS */
    css?: Object;
}
```

### Base

Глобальные стили проекта могут быть заданы через `global.base`. `ThemeProvider` вставляет базовые переопределения стилей для тегов и некоторые из них доступны для параметризации: стили выделения, фокуса и основная типографика/цвета (body).

♿️ GDS подключает полифилл [focus-visible](https://github.com/WICG/focus-visible), что позволяет отключить стилизацию обычных фокусов и оставить стилизацию только для фокуса с клавиатуры, т.о. фокусы появляются только тогда, когда они действительно нужны.

**Интерфейс:**

```js
interface IGlobalBase {
    /** Стили выделения */
    selection?: {
        /** Цвет текста */
        color?: string,
        /** Цвет фона */
        bg?: string,
        /** Кастомный CSS */
        css?: object,
    };
    /** Стили фокуса */
    focus?: {
        /** Толщина линии обводки */
        width?: number,
        /** Цвет обводки */
        color?: string,
        /** Отступ между обводкой и элементов */
        offset?: number,
        /** Кастомный CSS */
        css?: object,
    };
    /** Стили body */
    body: {
        /** Типографический стиль */
        typography: string,
        /** Цвет текста */
        color?: string,
        /** Цвет фона */
        bg: string,
        /** Кастомный CSS */
        css: object,
    };
}
```
