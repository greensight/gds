import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Dev / Typography" />

# Typography

✨ Theme: `typography`

✨ Tokens: `typography`

✨ Autokit: `Typography`

✨ Helpers: `typography`

Дизайнер определяет все используемые вариации типографики в Figma на фрейме `Typography`, выделяет под них стили и применяет на проекте. Стили разделены на 2 размера: `desktop` и `mobile`, при этом `mobile` может отсутствовать. Также дизайнер определяет значения брейкпоинтов для `desktop` и `mobile`.

<img src="images/typography/style-properties.png" alt="Параметры стиля Figma" width="500" />

_Параметры стиля Figma_

Все эти параметры загружаются на проект в формате токенов. В дальнейшем мы работаем на уровне имён стилей, передавая их в хелпер `typography`, который вернёт весь необходимый CSS.

**Интерфейс:**

```js
interface ITypography {
    /** Брейкпоинты, соответствующие desktop и mobile */
    breakpoints: [number, number];
    /** Набор фолбеков под отдельные шрифты. Не токенизируется */
    stacks?: {
        /** Список фолбеков */
        [fontName: string]: string;
    };
    /** Флюидная типографика. Передайте false для отключения на всём проекте */
    fluid?: boolean;
    /** Стиль типографики */
    [name: string]: {
        /** Свойства десктопной вариации */
        desktop: ITypographyProperties;
        /** Свойства мобильной вариации */
        mobile?: ITypographyProperties;
        /** Флюидная типографика. Передайте false для отключения для этого стиля */
        fluid?: boolean;
    };
}

interface ITypographyProperties {
    /** Название */
    fontFamily: string;
    /** Начертание */
    fontWeight: number;
    /** Размер кегля (rem) */
    fontSize: string;
    /** Высота строки (множитель) */
    lineHeight: number;
    /** Межбуквенное расстояние (em) */
    letterSpacing?: string;
    /** Стиль */
    fontStyle?: 'italic';
    /** Регистры */
    textTransform?: 'uppercase' | 'lowercase' | 'capitalize';
    /** Подчёркивания */
    textDecoration?: 'underline' | 'line-through';
    /** Равноширинные цифры */
    fontVariantNumeric?: 'tabular-nums';
}
```

⚠️ Чтобы использовать веб-шрифты, их нужно сначала подключить через **@font-face**. Это делается в глобальных стилях - смотрите документацию `ThemeProvider`.

## Флюидная типографика

По умолчанию для стилей, имеющих `mobile` версию, применяется плавное изменение размера шрифта между двумя точками, указанными в поле `breakpoints`. Вне этого диапазона размер фиксируется, чтобы избежать чрезмерного уменьшения/увеличения. Такой подход известен, как **fluid typography with locks**.

<img src="images/typography/fluid-typography.png" alt="Формула fluid typography" width="600" />

_Формула fluid typography_

Значение в больших скобках - это коэффициент. Когда он равен 0 (current vw = minimum vw), размер приравнивается к минимальному, когда он равен 1 (current vw = maximum vw) - к максимальному. Промежуточные значения получаются указанием в current vw значения в 100vw. В minimum vw при этом указывается размер шрифта в rem, чтобы происходил скейлинг от величины дефолтного шрифта в браузере пользователя.

⚠️ Дизайнер может попросить отключить флюидную типографику для проекта или отдельных стилей. Это можно сделать через поле `fluid` объекта темы (смотри интерфейс `ITypography`).

## Вариативные шрифты

⏱ Используйте вариативные шрифты, чтобы значительно снизить размер загружаемых шрифтов. Такой шрифт позволяет использовать один файл, весом сравнимый с одним начертанием, вместо множества ассетов под каждую вариацию `font-weight`.

Также вариативные шрифты открывают невозможные ранее возможности в виде анимированного изменения жирности и параметризации специфичых характеристик шрифта. Однако поддержка этих возможностей на наших проектах ограничена, т.к. у Figma нет поддержки вариативных шрифтов и количество кириллических шрифтов сильно ограничено.

Хелпер `typography` поддерживает вариативные шрифты. Если в определении шрифта в глобальных стилях указана опция `vf`, то он попробует загрузить вариативную вариацию вместо обычной. Детали подключения описаны в документации `ThemeProvider`.

## Фолбеки

По умолчанию для всех шрифтов в правило `font-family` добавляется `sans-serif` в качестве фолбека. Его можно и нужно переопределять, т.к. фолбеки будут отображаться во время загрузки шрифта и нужно максимально сократить ощущение визуального скачка при смене шрифта (FOUT).

⏱ Скачок происходит из-за того, что мы делаем текст сразу доступным пользователю, что критично для пользователей на медленном интернете, т.к. они пришли на ваш сайт прежде всего за контентом, а веб-шрифт может занять приличное время для загрузки. Такой режим отображения текста активируется через `font-display: swap`.

Для указания своих фолбеков используйте поле `stacks` объекта темы (смотри интерфейс `ITypography`).

Для подбора можно попробовать использовать [Font style matcher](https://meowni.ca/font-style-matcher/).

## Использование

Работа с текстом производится через хелпер `typography`.

Чтобы пользоваться хелпером на проекте, необходимо привязать к нему свой объект темы. Для этого создайте свой скрипт `typography`, который в дальнейшем будете вызывать вместо прямого вызова хелпера из пакета GDS:

```js
import { typography as gdsTypography } from '@greensight/gds';
import theme from './theme';

const typography = name => gdsTypography(name, theme);

export default typography;
```

Теперь, допустим, вам нужно задать стили типографики для некоторого текста. В макете у этого текста указан стиль:

<img src="images/typography/style.png" alt="Стиль Figma" width="300" />

_Стиль Figma_

Вы знаете имя стиля и можете передать его в хелпер `typography`:

```js
import typography from '../../scripts/typography';

const Example = () => <div css={{ ...typography('subheading') }}>Example</div>;
```

Теперь у текста проставлены все токенизируемые параметры, изменения на адаптиве, флюидная типографика и вариативные шрифты.
